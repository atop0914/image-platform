<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›¾ç‰‡å®¡æ ¸å¹³å°</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="app">
        <!-- ä¾§è¾¹æ  -->
        <aside class="sidebar">
            <div class="logo">
                <span class="logo-icon">ğŸ–¼ï¸</span>
                <span class="logo-text">å›¾ç‰‡å®¡æ ¸</span>
            </div>
            <nav class="nav">
                <a href="/" class="nav-item active">
                    <span class="nav-icon">ğŸ“‹</span>
                    <span>å¾…å®¡æ ¸</span>
                    <span class="badge" id="pendingBadge">0</span>
                </a>
                <a href="/records" class="nav-item">
                    <span class="nav-icon">ğŸ“Š</span>
                    <span>å®¡æ ¸è®°å½•</span>
                </a>
                <a href="/add" class="nav-item">
                    <span class="nav-icon">â•</span>
                    <span>æ·»åŠ å›¾ç‰‡</span>
                </a>
            </nav>
            <div class="stats-mini">
                <div class="stat-item">
                    <span class="stat-value approved" id="approvedCount">0</span>
                    <span class="stat-label">å·²é€šè¿‡</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value rejected" id="rejectedCount">0</span>
                    <span class="stat-label">å·²æ‹’ç»</span>
                </div>
            </div>
        </aside>

        <!-- ä¸»å†…å®¹ -->
        <main class="main">
            <header class="header">
                <h1>å¾…å®¡æ ¸å›¾ç‰‡</h1>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="location.href='/add'">
                        â• æ·»åŠ å›¾ç‰‡
                    </button>
                </div>
            </header>

            <div class="content">
                <div class="image-grid" id="imageGrid">
                    <!-- å›¾ç‰‡å¡ç‰‡å°†é€šè¿‡ JS æ¸²æŸ“ -->
                </div>
                <div class="empty-state" id="emptyState" style="display: none;">
                    <div class="empty-icon">ğŸ“­</div>
                    <p>æš‚æ— å¾…å®¡æ ¸å›¾ç‰‡</p>
                    <button class="btn btn-primary" onclick="location.href='/add'">æ·»åŠ å›¾ç‰‡</button>
                </div>
            </div>
        </main>
    </div>

    <script src="/static/js/app.js"></script>
    <script>
        // åŠ è½½æ•°æ®
        async function loadData() {
            try {
                const res = await fetch('/api/images?status=pending');
                const data = await res.json();
                
                document.getElementById('pendingBadge').textContent = data.total;
                
                // åŠ è½½ç»Ÿè®¡
                const approvedRes = await fetch('/api/images?status=approved');
                const approvedData = await approvedRes.json();
                document.getElementById('approvedCount').textContent = approvedData.total;
                
                const rejectedRes = await fetch('/api/images?status=rejected');
                const rejectedData = await rejectedRes.json();
                document.getElementById('rejectedCount').textContent = rejectedData.total;
                
                renderImages(data.records);
            } catch (e) {
                console.error(e);
            }
        }

        function renderImages(records) {
            const grid = document.getElementById('imageGrid');
            const empty = document.getElementById('emptyState');
            
            if (records.length === 0) {
                grid.style.display = 'none';
                empty.style.display = 'flex';
                return;
            }
            
            grid.style.display = 'grid';
            empty.style.display = 'none';
            
            grid.innerHTML = records.map(r => `
                <div class="image-card">
                    <div class="image-wrapper">
                        <img src="${r.path}" alt="${r.name}" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%23f0f0f0%22 width=%22100%22 height=%22100%22/><text x=%2250%22 y=%2255%22 text-anchor=%22middle%22 fill=%22%23999%22 font-size=%2212%22>å›¾ç‰‡åŠ è½½å¤±è´¥</text></svg>'">
                    </div>
                    <div class="card-body">
                        <h3 class="card-title" title="${r.name}">${r.name}</h3>
                        <p class="card-date">ğŸ“… ${r.date}</p>
                        <div class="card-actions">
                            <button class="btn btn-success btn-sm" onclick="quickModerate(${r.id}, 'approved')">âœ… é€šè¿‡</button>
                            <button class="btn btn-danger btn-sm" onclick="quickModerate(${r.id}, 'rejected')">âŒ æ‹’ç»</button>
                            <button class="btn btn-primary btn-sm" onclick="location.href='/moderate/${r.id}'">è¯¦ç»†</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        async function quickModerate(id, status) {
            try {
                const res = await fetch('/api/moderate', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({id, status, note: ''})
                });
                if (res.ok) {
                    loadData();
                }
            } catch (e) {
                alert('æ“ä½œå¤±è´¥');
            }
        }

        loadData();
    </script>
</body>
</html>
